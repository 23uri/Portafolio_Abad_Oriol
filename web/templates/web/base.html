{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Portafolio Oriol Abad{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/base.css' %}">

    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- HEADER -->
    <header class="main-header">
    <div class="container header-inner">
        <!-- Logo -->
        <div class="logo">
            <a href="{% url 'inicio' %}">Oriol Abad</a>
        </div>

        <!-- Checkbox oculto -->
        <input type="checkbox" id="menu-toggle" class="menu-toggle-checkbox" />

        <!-- Botón hamburguesa -->
        <label for="menu-toggle" class="menu-toggle" aria-label="Abrir menú">
            <span class="hamburger" aria-hidden="true">
                <span class="bar bar1"></span>
                <span class="bar bar2"></span>
                <span class="bar bar3"></span>
            </span>
            <span class="sr-only">Alternar menú</span>
        </label>

        <!-- Menú -->
        <nav class="menu">
            <a href="{% url 'quien_soy' %}">Quién soy</a>
            <a href="{% url 'contacto' %}">Contacto</a>
        </nav>

        <!-- Fullscreen overlay menu (hidden by default, shown when checkbox checked) -->
        <div class="menu-overlay" aria-hidden="true">
            <div class="overlay-inner">
                <header class="overlay-header">
                    <div class="overlay-logo"><a href="{% url 'inicio' %}">Oriol Abad</a></div>
                    <label for="menu-toggle" class="overlay-close" aria-label="Cerrar menú">
                        <span class="hamburger close-x" aria-hidden="true">
                            <span class="bar bar1"></span>
                            <span class="bar bar2"></span>
                            <span class="bar bar3"></span>
                        </span>
                    </label>
                </header>

                <nav class="overlay-nav" role="navigation" aria-label="Principal">
                    <a href="{% url 'quien_soy' %}">Quién soy</a>
                    <a href="{% url 'contacto' %}">Contacto</a>
                </nav>
            </div>
        </div>
    </div>
</header>



    <!-- CONTENIDO -->
    <main class="contenido">
        {% block content %}{% endblock %}
    </main>

    <!-- FOOTER -->
    <footer class="main-footer">
        <p>© 2025 Oriol Abad. Todos los derechos reservados.</p>
    </footer>

    <!-- Chatbase Script -->
    <script>
    (function(){
        if(!window.chatbase || window.chatbase("getState")!=="initialized"){
            window.chatbase=(...arguments)=>{
                if(!window.chatbase.q){window.chatbase.q=[]}
                window.chatbase.q.push(arguments)
            };
            window.chatbase=new Proxy(window.chatbase,{
                get(target,prop){
                    if(prop==="q"){return target.q}
                    return(...args)=>target(prop,...args)
                }
            });
        }
        const onLoad=function(){
            const script=document.createElement("script");
            script.src="https://www.chatbase.co/embed.min.js";
            script.id="OaaPZ7sZLApe7fArWBBoU";  /* <-- tu ID de Chatbase */
            script.domain="www.chatbase.co";
            document.body.appendChild(script);
        };
        if(document.readyState==="complete"){onLoad()}
        else{window.addEventListener("load",onLoad)}
    })();
    </script>

    <!-- Identity Verification -->
    <script>
        window.chatbase("setIdentity", {
            user_id: "{{ request.user.id|default:'guest' }}",
            user_name: "{{ request.user.username|default:'Invitado' }}"
        });
    </script>
    <!-- Menu close interactions: click outside, ESC, click link -->
    <script>
        (function(){
            const checkbox = document.getElementById('menu-toggle');
            const overlay = document.querySelector('.menu-overlay');
            const inner = document.querySelector('.overlay-inner');
            if(!checkbox || !overlay || !inner) return;

            // Click outside overlay-inner (close if the clicked element is not inside .overlay-inner)
            overlay.addEventListener('click', (e) => {
                try {
                    if (!inner.contains(e.target)) {
                        checkbox.checked = false;
                    }
                } catch (err) {
                    // fallback: close if click target is the overlay itself
                    if (e.target === overlay) checkbox.checked = false;
                }
            });

            // Close on Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && checkbox.checked) {
                    checkbox.checked = false;
                }
            });

            // Close when clicking any overlay link
            overlay.querySelectorAll('a').forEach(a => {
                a.addEventListener('click', () => { checkbox.checked = false; });
            });
        })();
    </script>
</body>
</html>
